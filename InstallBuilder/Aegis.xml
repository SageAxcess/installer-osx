<project>
    <shortName>Aegis</shortName>
    <fullName>Aegis Workstation Agent</fullName>
    <version>2.4.4</version>
    <componentList>
        <component>
            <name>networkmonitor</name>
            <description>AEGIS Network Monitor</description>
            <canBeEdited>0</canBeEdited>
            <selected>1</selected>
            <show>1</show>
            <folderList>
                <folder>
                    <description>Common components</description>
                    <destination>${installdir}</destination>
                    <name>programfiles</name>
                    <platforms>all</platforms>
                    <shortcutList>
                        <shortcut>
                            <comment>Uninstall</comment>
                            <exec>${installdir}/${uninstallerName}</exec>
                            <icon></icon>
                            <name>Uninstall ${product_fullname}</name>
                            <path>${installdir}</path>
                            <platforms>all</platforms>
                            <runAsAdmin>0</runAsAdmin>
                            <runInTerminal>0</runInTerminal>
                            <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                            <windowsExecArgs></windowsExecArgs>
                            <windowsIcon></windowsIcon>
                            <windowsPath>${installdir}</windowsPath>
                        </shortcut>
                    </shortcutList>
                </folder>
                <folder>
                    <description>Windows components</description>
                    <destination>${installdir}</destination>
                    <name>programfileswindows</name>
                    <platforms>windows</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>Content/win/AEGIS/zlib1.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/aegis.exe</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/curllib.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libbind.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libeay32.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libgcc_s_sjlj-1.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libgmp-10.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libgnutls-30.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libhogweed-4-2.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libmicrohttpd.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libnettle-6-2.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libp11-kit-0.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libsasl.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libsodium.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/libzmq.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/msvcp100.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/msvcp100d.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/msvcr100.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/msvcr100d.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/openldap.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/PlibC-0.1.5.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/pthread.dll</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/win/AEGIS/ssleay32.dll</origin>
                        </distributionFile>
                        <distributionDirectory>
                            <origin>Content/win/AEGIS/deploy</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>Content/win/AEGIS/scripts</origin>
                        </distributionDirectory>
                    </distributionFileList>
                    <shouldPackRuleList>
                        <compareText>
                            <logic>does_not_equal</logic>
                            <text>${InstallOnline}</text>
                            <value>1</value>
                        </compareText>
                    </shouldPackRuleList>
                </folder>
                <folder>
                    <description>Ubuntu wily components</description>
                    <destination>/</destination>
                    <name>root</name>
                    <platforms>linux-x64</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>files-linux/ubuntu_14-15/etc</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>files-linux/ubuntu_14-15/opt</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>files-linux/ubuntu_14-15/usr</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>files-linux/ubuntu_14-15/var</origin>
                        </distributionDirectory>
                    </distributionFileList>
                    <ruleList>
                        <fileContentTest>
                            <encoding>utf-8</encoding>
                            <logic>contains</logic>
                            <path>/etc/lsb-release</path>
                            <text>Ubuntu</text>
                        </fileContentTest>
                        <ruleGroup>
                            <ruleEvaluationLogic>or</ruleEvaluationLogic>
                            <ruleList>
                                <fileContentTest>
                                    <encoding>utf-8</encoding>
                                    <logic>contains</logic>
                                    <path>/etc/lsb-release</path>
                                    <text>14.04</text>
                                </fileContentTest>
                                <fileContentTest>
                                    <encoding>utf-8</encoding>
                                    <logic>contains</logic>
                                    <path>/etc/lsb-release</path>
                                    <text>14.10</text>
                                </fileContentTest>
                                <fileContentTest>
                                    <encoding>utf-8</encoding>
                                    <logic>contains</logic>
                                    <path>/etc/lsb-release</path>
                                    <text>15.04</text>
                                </fileContentTest>
                                <fileContentTest>
                                    <encoding>utf-8</encoding>
                                    <logic>contains</logic>
                                    <path>/etc/lsb-release</path>
                                    <text>15.10</text>
                                </fileContentTest>
                            </ruleList>
                        </ruleGroup>
                    </ruleList>
                </folder>
                <folder>
                    <description>Ubuntu xenial+zesty components</description>
                    <destination>/</destination>
                    <name>root2</name>
                    <platforms>linux-x64</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>files-linux/ubuntu_16-17/etc</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>files-linux/ubuntu_16-17/opt</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>files-linux/ubuntu_16-17/usr</origin>
                        </distributionDirectory>
                    </distributionFileList>
                    <ruleList>
                        <fileContentTest>
                            <encoding>utf-8</encoding>
                            <logic>contains</logic>
                            <path>/etc/lsb-release</path>
                            <text>Ubuntu</text>
                        </fileContentTest>
                        <ruleGroup>
                            <ruleEvaluationLogic>or</ruleEvaluationLogic>
                            <ruleList>
                                <fileContentTest>
                                    <encoding>utf-8</encoding>
                                    <logic>contains</logic>
                                    <path>/etc/lsb-release</path>
                                    <text>16.04</text>
                                </fileContentTest>
                                <fileContentTest>
                                    <encoding>utf-8</encoding>
                                    <logic>contains</logic>
                                    <path>/etc/lsb-release</path>
                                    <text>16.10</text>
                                </fileContentTest>
                                <fileContentTest>
                                    <encoding>utf-8</encoding>
                                    <logic>contains</logic>
                                    <path>/etc/lsb-release</path>
                                    <text>17.04</text>
                                </fileContentTest>
                            </ruleList>
                        </ruleGroup>
                    </ruleList>
                </folder>
                <folder>
                    <description>Mac OSX components</description>
                    <destination>${installdir}</destination>
                    <name>osxinstalldir</name>
                    <platforms>osx</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>Content/aegis_2.4.4-x86_64.tar.gz</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/AEGIS.safariextz</origin>
                        </distributionFile>
                        <distributionFile>
                            <origin>Content/sageaxcess-1.0.2.xpi</origin>
                        </distributionFile>
                    </distributionFileList>
                    <shouldPackRuleList>
                        <compareText>
                            <logic>does_not_equal</logic>
                            <text>${InstallOnline}</text>
                            <value>1</value>
                        </compareText>
                    </shouldPackRuleList>
                </folder>
                <folder>
                    <description>Mac OSX library dependencies</description>
                    <destination>/usr/local/opt</destination>
                    <name>osxlibs</name>
                    <platforms>osx</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>Content/osx/libs/libgnutls</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>Content/osx/libs/libmicrohttpd</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>Content/osx/libs/libsodium</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>Content/osx/libs/msgpack</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>Content/osx/libs/zeromq</origin>
                        </distributionDirectory>
                    </distributionFileList>
                </folder>
                <folder>
                    <description>CentOS 7 components</description>
                    <destination>/</destination>
                    <name>CentOS7</name>
                    <platforms>linux-x64</platforms>
                    <distributionFileList>
                        <distributionDirectory>
                            <origin>files-linux/centos7/opt</origin>
                        </distributionDirectory>
                        <distributionDirectory>
                            <origin>files-linux/centos7/usr</origin>
                        </distributionDirectory>
                    </distributionFileList>
                    <ruleList>
                        <fileContentTest>
                            <encoding>utf-8</encoding>
                            <logic>contains</logic>
                            <path>/etc/centos-release</path>
                            <text>CentOS Linux release 7</text>
                        </fileContentTest>
                    </ruleList>
                </folder>
                <folder>
                    <description>C:\Program Files (x86)</description>
                    <destination>${installdir}</destination>
                    <name>pf</name>
                    <platforms>all</platforms>
                    <distributionFileList>
                        <distributionFile>
                            <origin>Content/win/CheckEdgeVersion.exe</origin>
                        </distributionFile>
                    </distributionFileList>
                </folder>
            </folderList>
            <startMenuShortcutList>
                <startMenuShortcut>
                    <comment>Uninstall ${product_fullname}</comment>
                    <name>Uninstall ${product_fullname}</name>
                    <runAsAdmin>0</runAsAdmin>
                    <runInTerminal>0</runInTerminal>
                    <windowsExec>${installdir}/${uninstallerName}.exe</windowsExec>
                    <windowsExecArgs></windowsExecArgs>
                    <windowsIcon></windowsIcon>
                    <windowsPath>${installdir}/</windowsPath>
                </startMenuShortcut>
            </startMenuShortcutList>
        </component>
    </componentList>
    <preBuildActionList>
        <if>
            <actionList>
                <setInstallerVariable>
                    <name>InstallOnline</name>
                    <value>0</value>
                </setInstallerVariable>
            </actionList>
            <conditionRuleList>
                <fileExists>
                    <path>${build_project_directory}/Content/aegis_2.4.4-x86_64.tar.gz</path>
                </fileExists>
            </conditionRuleList>
            <elseActionList>
                <setInstallerVariable>
                    <name>InstallOnline</name>
                    <value>1</value>
                </setInstallerVariable>
            </elseActionList>
            <ruleList>
                <compareText>
                    <logic>equals</logic>
                    <text>${platform_name}</text>
                    <value>osx</value>
                </compareText>
            </ruleList>
        </if>
        <if>
            <actionList>
                <setInstallerVariable>
                    <name>InstallOnline</name>
                    <value>0</value>
                </setInstallerVariable>
                <createDirectory>
                    <path>${build_project_directory}/Content/win/AEGIS</path>
                </createDirectory>
                <unzip>
                    <destinationDirectory>${build_project_directory}/Content/win</destinationDirectory>
                    <zipFile>${build_project_directory}/Content/win/aegis-2.4.4-manual_x86_64.zip</zipFile>
                </unzip>
            </actionList>
            <conditionRuleList>
                <fileExists>
                    <path>${build_project_directory}/Content/win/aegis-2.4.4-manual_x86_64.zip</path>
                </fileExists>
            </conditionRuleList>
            <elseActionList>
                <setInstallerVariable>
                    <name>InstallOnline</name>
                    <value>1</value>
                </setInstallerVariable>
            </elseActionList>
            <ruleList>
                <compareText>
                    <logic>equals</logic>
                    <text>${platform_name}</text>
                    <value>windows</value>
                </compareText>
            </ruleList>
        </if>
    </preBuildActionList>
    <initializationActionList>
        <setInstallerVariable>
            <name>installdir</name>
            <ruleEvaluationLogic>or</ruleEvaluationLogic>
            <value>/usr/local/aegis</value>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </setInstallerVariable>
        <locate>
            <command>chkconfig</command>
            <variable>cmd_chkconfig</variable>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </locate>
        <locate>
            <command>sysv-rc-conf</command>
            <variable>cmd_sysv</variable>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </locate>
        <locate>
            <command>systemctl</command>
            <variable>cmd_systemctl</variable>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </locate>
        <if>
            <actionList>
                <setInstallerVariable>
                    <name>service_engine</name>
                    <value>systemctl</value>
                </setInstallerVariable>
            </actionList>
            <conditionRuleList>
                <compareTextLength>
                    <length>0</length>
                    <logic>greater</logic>
                    <text>${cmd_systemctl}</text>
                </compareTextLength>
            </conditionRuleList>
            <elseActionList>
                <if>
                    <actionList>
                        <setInstallerVariable>
                            <name>service_engine</name>
                            <value>sysv-rc-conf</value>
                        </setInstallerVariable>
                    </actionList>
                    <conditionRuleList>
                        <compareTextLength>
                            <length>0</length>
                            <logic>greater</logic>
                            <text>${cmd_sysv}</text>
                        </compareTextLength>
                    </conditionRuleList>
                    <elseActionList>
                        <setInstallerVariable>
                            <name>service_engine</name>
                            <value>initd</value>
                        </setInstallerVariable>
                    </elseActionList>
                </if>
            </elseActionList>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </if>
    </initializationActionList>
    <readyToInstallActionList>
        <createDirectory>
            <path>${installdir}</path>
            <ruleList>
                <compareText>
                    <logic>equals</logic>
                    <text>${InstallOnline}</text>
                    <value>1</value>
                </compareText>
            </ruleList>
        </createDirectory>
        <httpGet>
            <explanation>Downloading Safari extension</explanation>
            <filename>${installdir}/AEGIS.safariextz</filename>
            <progressText>Downloading Safari extension</progressText>
            <url>https://aegis-osx.s3.amazonaws.com/AEGIS.safariextz</url>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
                <compareText>
                    <logic>equals</logic>
                    <text>${InstallOnline}</text>
                    <value>1</value>
                </compareText>
            </ruleList>
        </httpGet>
        <httpGet>
            <explanation>Downloading Firefox extension</explanation>
            <filename>${installdir}/aegis.xpi</filename>
            <progressText>Downloading Firefox extension</progressText>
            <url>https://aegis-osx.s3.amazonaws.com/aegis.xpi</url>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
                <fileExists>
                    <path>/Applications/Firefox.app</path>
                </fileExists>
                <compareText>
                    <logic>equals</logic>
                    <text>${InstallOnline}</text>
                    <value>1</value>
                </compareText>
            </ruleList>
        </httpGet>
        <httpGet>
            <filename>${installdir}/aegis.xpi</filename>
            <url>https://aegis-osx.s3.amazonaws.com/aegis.xpi</url>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
                <compareText>
                    <logic>equals</logic>
                    <text>${InstallOnline}</text>
                    <value>1</value>
                </compareText>
            </ruleList>
        </httpGet>
        <httpGet>
            <filename>${installdir}/aegis.appx</filename>
            <url>https://aegis-osx.s3.amazonaws.com/aegis.appx</url>
        </httpGet>
    </readyToInstallActionList>
    <postInstallationActionList>
        <actionGroup>
            <actionList>
                <runProgram>
                    <program>tar</program>
                    <programArguments>xzvf ${installdir}/aegis_2.4.4-x86_64.tar.gz -C ${installdir}</programArguments>
                </runProgram>
                <deleteFile>
                    <path>${installdir}/aegis_2.4.4-x86_64.tar.gz</path>
                </deleteFile>
                <runProgram>
                    <program>cp</program>
                    <programArguments>-rfv ${installdir}/aegis/* ${installdir}</programArguments>
                </runProgram>
                <deleteFile>
                    <path>${installdir}/aegis</path>
                </deleteFile>
                <writeFile>
                    <encoding>utf-8</encoding>
                    <explanation>Update Aegis configuration file</explanation>
                    <path>${installdir}/conf/aegis.conf</path>
                    <text>############################
# Aegis config file
############################

# Aegis settings

# Specify interface name to listen on. For Windows - it will be something like \Device\NPF_{F53438F5-79C7-4A78-8254-B10D3CA50225}
# For Linux/OSX - en0 or eth0
# Use aegis --print-interfaces to see all available interfaces.
# Value of "*" means listen on all interfaces.
listen.interface=${ListenOn}
# Default policy to use. Cannot be applied without service restart. Defines scripts/features to be loaded.
default.policy=local

# Aggregator settings

# Main aggregator address. You can omit tcp:// and :port if it is default (5555)
zmq.server=tcp://${AggregatorHost}:${AggregatorPort}
# Comma-separated list of secondary aggregators. You can omit tcp:// and :port if it is default (5555)
#zmq.server.secondary=localhost,tcp://192.168.1.15:5556,tcp://data.sageaxcess.com
# Aggregator public key
zmq.public_key=${PublicKey}

# Local agent settings

# Plain http port
agent.port=${ExtensionPort}
# Https port
agent.port.ssl=8112

# Updater settings

# Automatic updates enabled/disabled flag. If enabled, updater will periodically check if there's a new version available
updates.enabled=${EnableAutomaticUpdates}
# Interval for automatic updates check, in minutes
updates.interval=60
# Remote control enabled/disabled flag. If enabled, plugin will query aggregator for a list of available commands each 1 minute.
remote.control=true
# Base url for remote updates
updater.url=https://aegis-osx.s3.amazonaws.com

# Remote input
#remote.input.interface=en0
#remote.input.key_file=
#remote.input.hostname=192.168.1.1
#remote.input.username=root
#remote.input.exec=tcpdump

# usage limits

# Process priority. 0 = normal, -20 = highest, 19 = lowest. Use any values in between
process.priority=0
# Maximum disk usage, percent. Will be applied if it's lower than value in Mb.
disk.usage.relative=10
# Maximum disk usage, in Mb. Will be applied if it's lower than value in %
disk.usage.absolute=500</text>
                </writeFile>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <customErrorMessage>Failed to install Safari extension</customErrorMessage>
                    <explanation>Install Safari Extension</explanation>
                    <program>open</program>
                    <programArguments>-a Safari ${installdir}/AEGIS.safariextz</programArguments>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <customErrorMessage>Failed to install Firefox extension</customErrorMessage>
                    <explanation>Install Firefox extension</explanation>
                    <program>cp</program>
                    <programArguments>-f ${installdir}/aegis.xpi /Applications/Firefox.app/Contents/Resources/browser/extensions/aegis.xpi</programArguments>
                    <ruleList>
                        <fileExists>
                            <path>/Applications/Firefox.app</path>
                        </fileExists>
                    </ruleList>
                </runProgram>
                <createDirectory>
                    <path>/Library/Application Support/Google/Chrome/External Extensions</path>
                </createDirectory>
                <writeFile>
                    <path>/Library/Application Support/Google/Chrome/External Extensions/aegis_chrome_id.json</path>
                    <text>{
    "external_update_url": "https://clients2.google.com/service/update2/crx"
}
</text>
                    <ruleList>
                        <platformTest>
                            <type>osx</type>
                        </platformTest>
                        <fileExists>
                            <path>/Library/Application Support/Google/Chrome</path>
                        </fileExists>
                    </ruleList>
                </writeFile>
                <writeFile>
                    <explanation>Installing AEGIS service</explanation>
                    <path>/Library/LaunchDaemons/aegis.plist</path>
                    <text>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;
&lt;plist version="1.0"&gt;
&lt;dict&gt;
	&lt;key&gt;Label&lt;/key&gt;
	&lt;string&gt;com.sageaxcess.aegis&lt;/string&gt;
	&lt;key&gt;ProgramArguments&lt;/key&gt;
	&lt;array&gt;
		&lt;string&gt;/usr/local/aegis/bin/aegis -i ${ListenOn} local&lt;/string&gt;
	&lt;/array&gt;
	&lt;key&gt;KeepAlive&lt;/key&gt;
	&lt;true/&gt;
&lt;/dict&gt;
&lt;/plist&gt;
</text>
                </writeFile>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>launchctl</program>
                    <programArguments>load /Library/LaunchDaemons/aegis.plist</programArguments>
                </runProgram>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        <actionGroup>
            <actionList>
                <createDirectory>
                    <path>${installdir}/logs</path>
                </createDirectory>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <explanation>Add Aegis Extension to Google Chrome x32</explanation>
                    <program>reg</program>
                    <programArguments>add HKEY_LOCAL_MACHINE\Software\Google\Chrome\Extensions\aegix_chrome_id /v update_url /d https://clients2.google.com/service/update2/crx /f</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <registryTest>
                            <key>HKEY_LOCAL_MACHINE\Software\Google\Chrome\Extensions</key>
                            <logic>exists</logic>
                            <name></name>
                        </registryTest>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <explanation>Add Aegis Extension to Google Chrome x64</explanation>
                    <program>cmd.exe</program>
                    <programArguments>/C reg -command add HKEY_LOCAL_MACHINE\Software\Wow6432Node\Google\Chrome\Extensions\aegix_chrome_id /v update_url /d https://clients2.google.com/service/update2/crx /f</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <createDirectory>
                    <path>${user_home_directory}\AppData\Roaming\Mozilla\Extensions\{ec8030f7-c20a-464f-9b0e-13a3a9e97384}</path>
                </createDirectory>
                <copyFile>
                    <destination>${user_home_directory}\AppData\Roaming\Mozilla\Extensions\{ec8030f7-c20a-464f-9b0e-13a3a9e97384}\aegis.xpi</destination>
                    <origin>${installdir}\aegis.xpi</origin>
                </copyFile>
                <runProgram>
                    <program>cmd.exe</program>
                    <programArguments>/C powershell -command "&amp; {&amp;'Add-AppxPackage' '${installdir}\aegis.appx'}"</programArguments>
                    <ruleList>
                        <platformTest>
                            <type>windows-10</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>${installdir}\CheckEdgeVersion.exe</program>
                    <programArguments>/minver 40.15</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <platformTest>
                            <type>windows-10</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
                <throwError>
                    <abortOnError>0</abortOnError>
                    <text>The extension could not be installed into version of Edge browser lower than 40.15063.674.0. Please update you Edge browser and try again.</text>
                    <ruleList>
                        <compareText>
                            <logic>does_not_equal</logic>
                            <text>${program_exit_code}</text>
                            <value>0</value>
                        </compareText>
                    </ruleList>
                </throwError>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        <actionGroup>
            <actionList>
                <writeFile>
                    <abortOnError>0</abortOnError>
                    <explanation>Update Aegis configuration file</explanation>
                    <path>/usr/local/aegis/conf/aegis.conf</path>
                    <text>############################
# Aegis config file
############################

# Aegis settings

# Specify interface name to listen on. For Windows - it will be something like \Device\NPF_{F53438F5-79C7-4A78-8254-B10D3CA50225}
# For Linux/OSX - en0 or eth0
# Use aegis --print-interfaces to see all available interfaces.
# Value of "*" means listen on all interfaces.
listen.interface=${ListenOn}
# Default policy to use. Cannot be applied without service restart. Defines scripts/features to be loaded.
default.policy=local

# Aggregator settings

# Main aggregator address. You can omit tcp:// and :port if it is default (5555)
zmq.server=tcp://${AggregatorHost}:${AggregatorPort}
# Comma-separated list of secondary aggregators. You can omit tcp:// and :port if it is default (5555)
#zmq.server.secondary=localhost,tcp://192.168.1.15:5556,tcp://data.sageaxcess.com
# Aggregator public key
zmq.public_key=${PublicKey}

# Local agent settings

# Plain http port
agent.port=${ExtensionPort}
# Https port
agent.port.ssl=8112

# Updater settings

# Automatic updates enabled/disabled flag. If enabled, updater will periodically check if there's a new version available
updates.enabled=${EnableAutomaticUpdates}
# Interval for automatic updates check, in minutes
updates.interval=60
# Remote control enabled/disabled flag. If enabled, plugin will query aggregator for a list of available commands each 1 minute.
remote.control=true
# Base url for remote updates
updater.url=http://build.sageaxcess.com

# Remote input
#remote.input.interface=en0
#remote.input.key_file=
#remote.input.hostname=192.168.1.1
#remote.input.username=root
#remote.input.exec=tcpdump

# usage limits

# Process priority. 0 = normal, -20 = highest, 19 = lowest. Use any values in between
process.priority=0
# Maximum disk usage, percent. Will be applied if it's lower than value in Mb.
disk.usage.relative=10
# Maximum disk usage, in Mb. Will be applied if it's lower than value in %
disk.usage.absolute=500</text>
                </writeFile>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>chmod</program>
                    <programArguments>-R 775 /usr/local/aegis</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>chmod</program>
                    <programArguments>+x /etc/init.d/aegis</programArguments>
                    <ruleEvaluationLogic>or</ruleEvaluationLogic>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>initd</value>
                        </compareText>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>sysv-rc-conf</value>
                        </compareText>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>cp</program>
                    <programArguments>-r ${installdir}/conf/aegis.service /usr/lib/systemd/system/</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>initd</value>
                        </compareText>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>sysv-rc-conf</value>
                        </compareText>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>sysv-rc-conf</program>
                    <programArguments>aegis on</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>initd</value>
                        </compareText>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>sysv-rc-conf</value>
                        </compareText>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>service</program>
                    <programArguments>aegis start</programArguments>
                    <ruleEvaluationLogic>or</ruleEvaluationLogic>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>initd</value>
                        </compareText>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>sysv-rc-conf</value>
                        </compareText>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>chkconfig</program>
                    <programArguments>--add aegis</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareTextLength>
                            <length>0</length>
                            <logic>greater</logic>
                            <text>${cmd_chkconfig}</text>
                        </compareTextLength>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>chkconfig</program>
                    <programArguments>aegis on</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareTextLength>
                            <length>0</length>
                            <logic>greater</logic>
                            <text>${cmd_chkconfig}</text>
                        </compareTextLength>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>ln</program>
                    <programArguments>-s ${installdir}/conf/init-script /etc/init.d/aegis</programArguments>
                    <ruleEvaluationLogic>or</ruleEvaluationLogic>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>systemctl</value>
                        </compareText>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>systemctl</program>
                    <programArguments>enable aegis.service</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>systemctl</value>
                        </compareText>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>systemctl</program>
                    <programArguments>start aegis.service</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <compareText>
                            <logic>equals</logic>
                            <text>${service_engine}</text>
                            <value>systemctl</value>
                        </compareText>
                    </ruleList>
                </runProgram>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>linux-x64</type>
                </platformTest>
            </ruleList>
        </actionGroup>
    </postInstallationActionList>
    <preUninstallationActionList>
        <deleteWindowsService>
            <displayName></displayName>
            <serviceName>Aegis</serviceName>
        </deleteWindowsService>
        <runProgram>
            <abortOnError>0</abortOnError>
            <program>service</program>
            <programArguments>aegis stop</programArguments>
            <ruleList>
                <platformTest>
                    <type>linux-x64</type>
                </platformTest>
                <compareText>
                    <logic>equals</logic>
                    <text>${service_engine}</text>
                    <value>initd</value>
                </compareText>
            </ruleList>
        </runProgram>
        <runProgram>
            <abortOnError>0</abortOnError>
            <program>systemctl</program>
            <programArguments>stop aegis.service</programArguments>
            <ruleList>
                <platformTest>
                    <type>linux-x64</type>
                </platformTest>
                <compareText>
                    <logic>equals</logic>
                    <text>${service_engine}</text>
                    <value>systemctl</value>
                </compareText>
            </ruleList>
        </runProgram>
    </preUninstallationActionList>
    <postUninstallationActionList>
        <actionGroup>
            <actionList>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>launchctl</program>
                    <programArguments>unload /Library/LaunchDaemons/aegis.plist</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                </runProgram>
                <deleteFile>
                    <abortOnError>0</abortOnError>
                    <path>/Library/LaunchDaemons/aegis.plist</path>
                    <showMessageOnError>0</showMessageOnError>
                </deleteFile>
                <deleteFile>
                    <abortOnError>0</abortOnError>
                    <path>~/Library/Safari/Extensions/AEGIS.safariextz</path>
                    <showMessageOnError>0</showMessageOnError>
                </deleteFile>
                <deleteFile>
                    <abortOnError>0</abortOnError>
                    <path>/usr/local/bin/aegis</path>
                    <showMessageOnError>0</showMessageOnError>
                </deleteFile>
                <deleteFile>
                    <abortOnError>0</abortOnError>
                    <path>/usr/local/aegis</path>
                    <showMessageOnError>0</showMessageOnError>
                </deleteFile>
                <deleteFile>
                    <abortOnError>0</abortOnError>
                    <path>/usr/local/opt/aegis</path>
                    <showMessageOnError>0</showMessageOnError>
                </deleteFile>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>osx</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        <actionGroup>
            <actionList>
                <deleteFile>
                    <abortOnError>0</abortOnError>
                    <path>/usr/local/aegis</path>
                    <showMessageOnError>0</showMessageOnError>
                </deleteFile>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>linux</type>
                </platformTest>
            </ruleList>
        </actionGroup>
        <actionGroup>
            <actionList>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>reg</program>
                    <programArguments>delete HKEY_LOCAL_MACHINE\Software\Google\Chrome\Extensions\ljggkhkdbndekocjhnhnebkilnmaeopj /f</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <platformTest>
                            <type>windows-x86</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <program>reg</program>
                    <programArguments>delete HKEY_LOCAL_MACHINE\Software\Wow6432Node\Google\Chrome\Extensions\ljggkhkdbndekocjhnhnebkilnmaeopj /f</programArguments>
                    <showMessageOnError>0</showMessageOnError>
                    <ruleList>
                        <platformTest>
                            <type>windows-x64</type>
                        </platformTest>
                    </ruleList>
                </runProgram>
                <registryGet>
                    <key>SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\SageAxcess</key>
                    <name>UninstallString</name>
                    <variable>ie_uninstall</variable>
                    <ruleList>
                        <platformTest>
                            <type>windows-x86</type>
                        </platformTest>
                    </ruleList>
                </registryGet>
                <registryGet>
                    <key>SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall\SageAxcess</key>
                    <name>UninstallString</name>
                    <variable>ie_uninstall</variable>
                    <ruleList>
                        <platformTest>
                            <type>windows-x64</type>
                        </platformTest>
                    </ruleList>
                </registryGet>
                <runProgram>
                    <program>${ie_uninstall}</program>
                    <programArguments>/S</programArguments>
                </runProgram>
                <runProgram>
                    <abortOnError>0</abortOnError>
                    <explanation>Reinstalling packet driver</explanation>
                    <program>msiexec.exe</program>
                    <programArguments>/X{7F3ADE9E-D317-47f2-9DC8-754887CD242A} /qn /norestart /L*V aegis-pcap-uninstall.log</programArguments>
                    <progressText>Reinstalling packet driver</progressText>
                    <ruleEvaluationLogic>or</ruleEvaluationLogic>
                    <show>0</show>
                    <showMessageOnError>0</showMessageOnError>
                </runProgram>
            </actionList>
            <ruleList>
                <platformTest>
                    <type>windows</type>
                </platformTest>
            </ruleList>
        </actionGroup>
    </postUninstallationActionList>
    <createOsxBundleDmg>1</createOsxBundleDmg>
    <disableSplashScreen>1</disableSplashScreen>
    <enableRollback>1</enableRollback>
    <enableSslSupport>1</enableSslSupport>
    <enableTimestamp>1</enableTimestamp>
    <height>550</height>
    <requireInstallationByRootUser>1</requireInstallationByRootUser>
    <saveRelativePaths>1</saveRelativePaths>
    <vendor>Change Dynamix, Inc.</vendor>
    <width>600</width>
    <parameterList>
        <parameterGroup>
            <name>Advanced</name>
            <explanation></explanation>
            <value></value>
            <default></default>
            <parameterList>
                <stringParameter>
                    <name>ListenOn</name>
                    <description>Listen on:</description>
                    <explanation>Network Interface</explanation>
                    <value></value>
                    <default>*</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>60</width>
                </stringParameter>
                <booleanParameter>
                    <name>EnableAutomaticUpdates</name>
                    <description>Enable automatic updates</description>
                    <explanation></explanation>
                    <value>0</value>
                    <default></default>
                    <displayStyle>checkbox-left</displayStyle>
                </booleanParameter>
                <parameterGroup>
                    <name>AggregatorSettings</name>
                    <explanation>Aggregator settings</explanation>
                    <value></value>
                    <default></default>
                </parameterGroup>
                <stringParameter>
                    <name>AggregatorHost</name>
                    <description>Aggregator host:</description>
                    <explanation></explanation>
                    <value></value>
                    <default>localhost</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>60</width>
                </stringParameter>
                <stringParameter>
                    <name>AggregatorPort</name>
                    <description>Aggregator port:</description>
                    <explanation></explanation>
                    <value></value>
                    <default>5555</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>20</width>
                </stringParameter>
                <stringParameter>
                    <name>PublicKey</name>
                    <description>Public key:</description>
                    <explanation></explanation>
                    <value></value>
                    <default>5A5832576F434D2D57367D667148464865326E3C4B74586B733C574C7A624E6355642D5239282E7200</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>60</width>
                </stringParameter>
                <stringParameter>
                    <name>ExtensionPort</name>
                    <description>Extension port:</description>
                    <explanation>Local Agent settings</explanation>
                    <value></value>
                    <default>8111</default>
                    <allowEmptyValue>0</allowEmptyValue>
                    <width>20</width>
                </stringParameter>
            </parameterList>
        </parameterGroup>
        <directoryParameter>
            <name>installdir</name>
            <description>Installer.Parameter.installdir.description</description>
            <explanation>Installer.Parameter.installdir.explanation</explanation>
            <value></value>
            <default>${platform_install_prefix}/ChangeDynamix/AEGIS</default>
            <allowEmptyValue>0</allowEmptyValue>
            <ask>yes</ask>
            <cliOptionName>prefix</cliOptionName>
            <mustBeWritable>yes</mustBeWritable>
            <mustExist>0</mustExist>
            <width>50</width>
            <ruleList>
                <platformTest>
                    <negate>1</negate>
                    <type>linux-x64</type>
                </platformTest>
            </ruleList>
        </directoryParameter>
        <booleanParameter>
            <name>InstallOnline</name>
            <title>Online installer</title>
            <description>Online installer</description>
            <explanation></explanation>
            <value></value>
            <default></default>
            <ask>0</ask>
            <cliOptionShow>0</cliOptionShow>
            <displayStyle>checkbox-left</displayStyle>
        </booleanParameter>
    </parameterList>
</project>

